<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX-TEST</title>
  </head>
  <body>
    <ul id="ajax">
      <li><button id="ajax-wrong">XMLHttpRequest: wrong url</button></li>
      <li><button id="ajax-200">XMLHttpRequest: 200</button></li>
      <li><button id="ajax-401">XMLHttpRequest: 401</button></li>
      <li><button id="ajax-404">XMLHttpRequest: 404</button></li>
      <li><button id="ajax-500">XMLHttpRequest: 500</button></li>
    </ul>
    <ul id="fetch">
      <li><button id="fetch-wrong">fetch: wrong url</button></li>
      <li><button id="fetch-200">fetch: 200</button></li>
      <li><button id="fetch-401">fetch: 401</button></li>
      <li><button id="fetch-404">fetch: 404</button></li>
      <li><button id="fetch-500">fetch: 500</button></li>
    </ul>
    <div>
      <b>Response:</b>
      <pre id="result"></pre>
    </div>
  </body>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script type="module">
    import { Request } from '../dist/index.mjs'
    // init interceptor
    const request = new Request()

    const ajax = document.getElementById('ajax')
    const fetch = document.getElementById('fetch')
    const result = document.getElementById('result')

    const instance = axios.create({
      baseURL: 'http://localhost:3000',
    })
    const ajaxWrong = () => axios.get('http://:wrong')
    const ajax200 = () => instance.get('/200')
    const ajax401 = () => instance.get('/401')
    const ajax404 = () => instance.get('/notFound')
    const ajax500 = () => instance.get('/500')

    ajax.addEventListener('click', (e) => {
      const id = e.target.id
      const fireMap = {
        'ajax-wrong': ajaxWrong,
        'ajax-200': ajax200,
        'ajax-401': ajax401,
        'ajax-404': ajax404,
        'ajax-500': ajax500,
      }
      if (fireMap[id]) {
        fireMap[id]()
          .then((res) => {
            result.innerHTML = JSON.stringify(res, null, 2)
          })
          .catch((err) => {
            result.innerHTML = err
          })
      }
    })

    fetch.addEventListener('click', (e) => {
      const id = e.target.id
      const fireMap = {
        'fetch-wrong': () => window.fetch('http://:wrong', { method: 'get' }),
        'fetch-200': () => window.fetch('http://localhost:3000/200', { method: 'get' }),
        'fetch-401': () => window.fetch('http://localhost:3000/401', { method: 'get' }),
        'fetch-404': () => window.fetch('http://localhost:3000/notFound', { method: 'get' }),
        'fetch-500': () => window.fetch('http://localhost:3000/500', { method: 'get' }),
      }
      if (fireMap[id]) {
        let response
        fireMap[id]()
          .then((res) => {
            response = res.clone()
            return res.json()
          })
          .then((body) => {
            result.innerHTML = JSON.stringify({
              body,
              bodyUsed: response.bodyUsed,
              headers: {
                'content-type': response.headers.get('content-type'),
                'content-length': response.headers.get('content-length'),
              },
              status: response.status,
              statusText: response.statusText,
              ok: response.ok,
              type: response.type,
              redirected: response.redirected,
              url: response.url,
            }, null, 2)
          })
          .catch((err) => {
            result.innerHTML = err
          })
      }
    })
  </script>
</html>
